{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static '/css/diary/diary_home.css'%}">
  <link rel="stylesheet" href="{% static '/css/home/main.css'%}">
  <link rel="stylesheet" href="{% static '/css/home/main.css'%}">
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
  <title>ë‹¤ì´ì–´ë¦¬ HOME</title>
</head>

<!-- ê³µí†µ ìƒë‹¨ì¢Œì¸¡ë©”ë‰´ -->
<script>
  if("{{gmsg}}"=='1'){
    alert("ê°€ì¡± ë‹¤ì´ì–´ë¦¬ê°€ ë§Œë“¤ì–´ì¡Œì–´ìš”.")
    location.href = '/diary/diaryHome/'
  }
  $(function() {
    // GNB í´ë¦­
    $('#menu ul li').on('click', function() {
      $('#menu ul li').removeClass('active');
      $(this).addClass('active');
    });
  });
</script>
</head>
<body>
<!-- ìµœìƒë‹¨ ë©”ë‰´ -->
<div id="top_nav">
  <h1><a href="#"></a></h1>
  <ul class="top_menu">
    <li><a href="#"><img src="/static/images/home/search_icon.png" alt=""></a></li>
    <li><a href="#"><img src="/static/images/home/bell_off_icon.png" alt=""></a></li>
    <li><a href="#">ë§ˆì´í˜ì´ì§€</a></li>
  </ul>

</div>

<!-- ì¢Œì¸¡ gnb -->
<div id="gnb">

  <!-- í”„ë¡œí•„ -->
  <div id="user_profile">
    <div id="pimg">
      <img src="/static/images/home/default_profile.png" alt="">
    </div>
    <p id="uName">ê¹€ìš©ì¤€</p>
    <p id="uEmail">kyjoon0105@gmail.com</p>
  </div>

  <!-- Nav -->
  <nav id="menu">
    <ul>
      <a href="#"><li class="menu_item">ìš°ë¦¬ ê°€ì¡± ì´ì•¼ê¸°</li></a>
      <a href="#"><li class="menu_item active">ë‹¤ì´ì–´ë¦¬</li></a>
      <a href="#"><li class="menu_item">ê°ì • ëŒì•„ë³´ê¸°</li></a>
      <a href="#"><li class="menu_item">ìš°ë¦¬ê°€ì¡±</li></a>
      <a href="#"><li class="menu_item">ìº˜ë¦°ë”</li></a>
      <a href="#"><li class="menu_item">ì•Œë ¤ë“œë ¤ìš”</li></a>
    </ul>
  </nav>

  <!-- logout -->
  <div id="logout">
    <a href="#"><span>ë¡œê·¸ì•„ì›ƒ</span></a>
  </div>
  
</div>
<!-- ê³µí†µ ìƒë‹¨ì¢Œì¸¡ë©”ë‰´ -->


<!-- ë‹¤ì´ì–´ë¦¬ HOME -->
<div id="all_area">
  <!-- ìƒë‹¨ë¶€ë¶„ -->
  <div id="title_area">
    <p id="topTit">ë‹¤ì´ì–´ë¦¬<span id="searchBar"><input type="text" name="search" placeholder="ê²€ìƒ‰"></span>
    <span><a href="/diary/diaryMake/"><button id="plusBtn"><img src="/static/images/diary/plusBtn.png" alt=""></button></a></span></p>      
  </div>

  <!-- ë©”ì¸ë¶€ë¶„ -->
  <div id="main_area">

  <button class="prev-btn"><img src="/static/images/diary/Arrow_drop_left.png" alt=""></button>
  <div class="carousel">
    <div class="image-container">

      <div class="card" id="firstCard"><a href="/diary/FdiaryList/"><img src="/static/images/diary/diary.png" alt="">
        <div id="dFirst_area">
          <div class="diary_group">
            <p>Family Dairy</p>
          </div>
          <div class="diary_title">
            <p>ìš°ë¦¬ ê°€ì¡± ì¼ê¸°ë¥¼<br> ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p>
          </div>
        </div>
        <div class="diary_member">
          <p>ê¹€ìš©ì¤€{{member.name}}</p>
        </div>
        <div class="diary_date">
          <p>2023.12.04 ~</p>
        </div>
      </a></div>

      <div class="card" id="secondCard"><a href="/diary/MdiaryList/"><img src="/static/images/diary/diary.png" alt="">
      <div class="card"><a href="/diary/MdiaryList/"><img src="/static/images/diary/diary.png" alt="">
        <div id="dFirst_area">
          <div class="diary_group">
            <p>My Dairy</p>
          </div>
          <div class="diary_title">
            <p>ë‚´ ë‹¤ì´ì–´ë¦¬ ì´ë¦„ì„<br> ì„¤ì •í•´ ì£¼ì„¸ìš”.</p>
          </div>
        </div>
        <div class="diary_member">
          <p>ê¹€ìš©ì¤€{{member.name}}</p>
        </div>
        <div class="diary_date">
          <p>2023.09.28 ~{{member.mdate}}</p>
        </div>
      </a></div>

      <div class="card"><a href="#"><img src="/static/images/diary/diary.png" alt="">
        <div id="dFirst_area">
          <div class="diary_group">
            <p>Family Dairy</p>
          </div>
          <div class="diary_title">
            <p>ìš°ë¦¬ ê°€ì¡± ì¼ê¸°ë¥¼<br> ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p>
          </div>
        </div>
        <div class="diary_member">
          <p>ê¹€ìš©ì¤€{{member.name}}</p>
        </div>
        <div class="diary_date">
          <p>2023.12.04 ~{{member.mdate}}</p>
          <p>2023.12.04 ~</p>
        </div>
      </a></div>

      <div class="card"><a href="/diary/MdiaryList/"><img src="/static/images/diary/diary.png" alt="">
        <div id="dFirst_area">
          <div class="diary_group">
            <p>My Dairy</p>
          </div>
          <div class="diary_title">
            <p>ë‚´ê°€ í•œ ë§ì„<br> ë‚´ê°€ ì˜¤í•´í•˜ì§€ ì•Šê¸°ë¡œ í•¨</p>
          </div>
        </div>

        <div class="diary_member">
          <p>ê¹€ìš©ì¤€</p>
        </div>

        <div class="diary_date">
          <p>2023.09.28 ~</p>
        </div>
      </a></div>

    </div>
  </div>
  <button class="next-btn"><img src="/static/images/diary/Arrow_drop_right.png" alt=""></button>
  </div>

  <div id="mailbox_container">
    <!-- ì–´ë‘ìš´ ë°°ê²½ ë ˆì´ì–´ -->
    <div id="dark_background"></div>

    <!-- ìš°ì²´í†µ ë²„íŠ¼ -->
    <button id="mailBtn">
      <img id="mailBtn_icon" src="/static/images/diary/mailbox_alert_off.png" alt="">
    </button>
    
    <!-- ìš°ì²´í†µ ë¦¬ìŠ¤íŠ¸ -->
    <div id="mailbox_list">
      <div class="list_header">ìš°ì²´í†µ</div>
      <ul>
        {% if list %}
        {% for letter in list  %}
        <li data-id="{{letter.lno}}" class="mail_item"><a href="#">
          <input type="hidden" name="lcontent" value="{{letter.lcontent}}" >
          <input type="hidden" name="user_nic" value="{{user_nic}}" >
          <input type="hidden" name="sent_nic" value="{{letter.member.nicName}}" >
          <span class="mail_tit">{{letter.ltitle}}</span>
          <span class="mail_date">{{letter.ldate|date:'Y.m.d'}}</span>
        </a>
      </li>
      
      {% comment %} <li data-id="2" class="mail_item"><a href="#">
        <span class="mail_tit">ì•„ë“¤ì•„ ì•„ë¹ ë‹¤. ì˜ ì§€ë‚´ë‹ˆ?</span>
        <span class="mail_date">2024.11.16</span>
      </a>
    </li>
    
    <li data-id="3" class="mail_item"><a href="#">
      <span class="mail_tit">ì˜¤ë¹ ~ ìƒì¼ ì¶•í•˜í•´! ğŸ‰</span>
      <span class="mail_date">2024.02.23</span>
    </a>
  </li> {% endcomment %}
  {% endfor %}
  {% else %}
  <li>í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endif %}
      </ul>
    </div>
  </div>
 

  <!-- í¸ì§€ì§€ ì°½ -->
  <div class="letter_container" id="letter_container">
    <div class="letter" id="letter">
      <div class="letter_header">
        <p><strong>To. ë°›ëŠ” ì‚¬ëŒ ë‹‰ë„¤ì„ì´ ë“¤ì–´ê°€ì•¼í•¨..</strong></p>
      </div>
      <div class="letter_content"><p>ê³ ë¯¼ì„ ì¢€ ë” í•´ë´ì•¼í•  ë“¯..</p></div>
      <div class="letter_footer">
        <p><strong>From. ë‹‰ë„¤ì„ì´ ë“¤ì–´ê°€ì•¼í•¨..</strong></p>
      </div>
    </div>

    {% comment %} <div class="letter" id="letter-2">
      <div class="letter_header">
        <p><strong>To. ì•„ë“¤</strong></p>
      </div>
      <div class="letter_content"><p>ì•„ë“¤ì•„ ì•„ë¹ ë‹¤. ì˜ ì§€ë‚´ë‹ˆ?</p>
      </div>
      <div class="letter_footer"><p><strong>From. ì—„ë§ˆ</strong></p>
      </div>
    </div>

    <div class="letter" id="letter-3">
      <div class="letter_header">
        <p><strong>To. ì˜¤ë¹ </strong></p>
      </div>
      <div class="letter_content"><p>ì˜¤ë¹ ~ ìƒì¼ ì¶•í•˜í•´! ğŸ‰</p>
      </div>
      <div class="letter_footer"><p><strong>From. ì—¬ë™ìƒ</strong></p>
      </div>
    </div> {% endcomment %}

  </div>


  <!-- ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // localStorageì—ì„œ ë°ì´í„° ì½ê¸°
        const savedDiaryData = localStorage.getItem('diaryData');
    
        if (savedDiaryData) {
            const diaryData = JSON.parse(savedDiaryData);
    
            // #firstCardì— ë°ì´í„° ì—…ë°ì´íŠ¸ (groupName ì œì™¸)
            const firstCard = document.getElementById('firstCard');
            firstCard.querySelector('.diary_title p').textContent = diaryData.title; // ì œëª©ë§Œ ì—…ë°ì´íŠ¸
            firstCard.querySelector('.diary_member p').textContent = diaryData.members; // ë©¤ë²„ ì—…ë°ì´íŠ¸
            firstCard.querySelector('.diary_date p').textContent = `${diaryData.date} ~`; // ë‚ ì§œ ì—…ë°ì´íŠ¸
    
            // .diary_group pëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ (ê¸°ë³¸ ê°’ ìœ ì§€)
    
            // ë°ì´í„° ì‚¬ìš© í›„ localStorageì—ì„œ ì‚­ì œ (ì„ íƒì‚¬í•­)
            localStorage.removeItem('diaryData');
        }
    });
  

    const cards = document.querySelectorAll(".image-container .card");
    const prevBtn = document.querySelector(".prev-btn");
    const nextBtn = document.querySelector(".next-btn");
    let currentIndex = 1; // Default center card index
    // Update card positions
    function updateCards() {
      cards.forEach((card, index) => {
        card.classList.remove("center", "left", "right");
        if (index === currentIndex) {
          card.classList.add("center");
        } else if (index === (currentIndex - 1 + cards.length) % cards.length) {
          card.classList.add("left");
        } else if (index === (currentIndex + 1) % cards.length) {
          card.classList.add("right");
        }
      });
    }
    // Left button functionality
    prevBtn.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + cards.length) % cards.length;
      updateCards();
    });
    // Right button functionality 
    nextBtn.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % cards.length;
      updateCards();
    });
    // Initial setup
    updateCards();



    // ìš°ì²´í†µ ë¦¬ìŠ¤íŠ¸
    document.addEventListener('DOMContentLoaded', () => {
      const mailboxBtn = document.getElementById('mailBtn');
      const mailboxList = document.getElementById('mailbox_list');

      let isOpen = false;

      mailboxBtn.addEventListener('click', () => {
        if (isOpen) {
          // ë‹«ê¸°
          mailboxList.style.right = '-400px';
        } else {
          // ì—´ê¸°
          mailboxList.style.right = '0';
        }
        isOpen = !isOpen; // ìƒíƒœ ë³€ê²½
      });
    });


    // ìš°ì²´í†µ ì•„ì´ì½˜ ë³€ê²½
    document.addEventListener('DOMContentLoaded', () => {
      const mailboxBtn = document.getElementById('mailBtn'); // ë²„íŠ¼
      const mailboxIcon = document.getElementById('mailBtn_icon'); // ì•„ì´ì½˜ ì´ë¯¸ì§€

      let isOpen = false; // ìƒíƒœ ë³€ìˆ˜ (ì—´ë¦°/ë‹«íŒ ìƒíƒœ)

      mailboxBtn.addEventListener('click', () => {
        if (isOpen) {
          // ë‹«íŒ ìƒíƒœë¡œ ë³€ê²½
          mailboxIcon.src = '/static/images/diary/mailbox_alert_on.png'; // ë‹«íŒ ìš°ì²´í†µ ì´ë¯¸ì§€
          mailboxBtn.style.backgroundColor = '#ffffff'; // ì´ˆê¸° ë°°ê²½ìƒ‰
        } else {
          // ì—´ë¦° ìƒíƒœë¡œ ë³€ê²½
          mailboxIcon.src = '/static/images/diary/mailbox_alert_off.png'; // ì—´ë¦° ìš°ì²´í†µ ì´ë¯¸ì§€
          mailboxBtn.style.backgroundColor = '#FAFDFF'; // ë³€ê²½ëœ ë°°ê²½ìƒ‰
        }
        isOpen = !isOpen; // ìƒíƒœ ë°˜ì „
      });
    });


    // í¸ì§€ì§€ ì°½
    document.addEventListener('DOMContentLoaded', () => {
      const mailItems = document.querySelectorAll('.mail_item'); // ë¦¬ìŠ¤íŠ¸ í•­ëª©
      const letterContainer = document.getElementById('letter_container'); // í¸ì§€ì§€ ì°½
      const letters = document.querySelectorAll('.letter'); // ëª¨ë“  í¸ì§€ì§€ ë‚´ìš©
      const darkBackground = document.getElementById('dark_background'); // ì–´ë‘ìš´ ë°°ê²½ ë ˆì´ì–´
      
      
      // ìš°ì²´í†µ ë¦¬ìŠ¤íŠ¸ í•­ëª© í´ë¦­ ì‹œ
      mailItems.forEach(item => {
        item.addEventListener('click', () => {
          // ëª¨ë“  í¸ì§€ì§€ ìˆ¨ê¸°ê¸°
          letters.forEach(letter => (letter.style.display = 'none'));

          // í´ë¦­ëœ í•­ëª©ì˜ í¸ì§€ì§€ ë³´ì—¬ì£¼ê¸°
          const letterId = item.getAttribute('data-id');
          //ê¸€ì œëª©
          const ltitle = item.querySelector('.mail_tit').textContent;
          //ê¸€ë‚´ìš©
          const lcontent = item.querySelector('input[name="lcontent"]').value;
          //ê¸€ë‚ ì§œ
          const mail_date = item.querySelector('.mail_date').textContent;

          //ë°›ëŠ” ì‚¬ëŒ
          const nicName = item.querySelector('input[name="user_nic"]').value;
          const sent_nic = item.querySelector('input[name="sent_nic"]').value;

          const targetLetter = document.getElementById(`letter`);
          console.log("letterId : "+letterId);
          console.log("ltitle : "+ltitle);
          console.log("lcontent : "+lcontent);
          console.log("mail_date : "+mail_date);
          console.log("ë°›ëŠ”ì‚¬ëŒ : "+nicName);
          console.log("ë³´ë‚¸ì‚¬ëŒ : "+sent_nic);
          

          if (targetLetter) {
            targetLetter.style.display = 'block';
            //ë°ì´í„° ë„£ê¸°
            console.log(targetLetter.querySelector('.letter_header'))
            
            targetLetter.querySelector('.letter_header').innerHTML = `<p><strong>To. ${nicName}</strong></p>`;
            targetLetter.querySelector('.letter_content').innerHTML = `<p>${lcontent}</p>`;
            targetLetter.querySelector('.letter_footer').innerHTML = `<p><strong>From. ${sent_nic}</strong></p>`;
          }

          // í¸ì§€ì§€ ì°½ ë° ì–´ë‘ìš´ ë°°ê²½ í‘œì‹œ
          letterContainer.style.display = 'block';
          darkBackground.style.display = 'block';
        });
      });

      // ì–´ë‘ìš´ ë°°ê²½ í´ë¦­ ì‹œ ì°½ ë‹«ê¸°
      darkBackground.addEventListener('click', () => {
        letterContainer.style.display = 'none';
        darkBackground.style.display = 'none';
      });
    });
  </script>


  
</body>
</html>