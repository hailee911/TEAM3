{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static '/css/diary/Mdiary_list.css'%}">
  <link rel="stylesheet" href="{% static '/css/home/main.css'%}">
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <title>ë‚´ ë‹¤ì´ì–´ë¦¬ ëª©ë¡</title> 
</head>

<!-- ê³µí†µ ìƒë‹¨ì¢Œì¸¡ë©”ë‰´ -->
<script>
  // ë‹¤ì´ì–´ë¦¬ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜
  function enableEdit() {
    let titleInput = document.getElementById('diaryTitleInput');
    titleInput.disabled = false;  // ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ í™œì„±í™”
    titleInput.focus();  // ì»¤ì„œë¥¼ ì…ë ¥ë€ì— ìœ„ì¹˜ì‹œí‚´
    
    // ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ ìƒì„±
    let saveBtn = document.createElement('button');
    saveBtn.innerHTML = 'ìˆ˜ì • ì™„ë£Œ';
    saveBtn.onclick = saveTitle;
    
    // ê¸°ì¡´ì— ìˆë˜ ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ì´ ìˆë‹¤ë©´ ì‚­ì œ í›„ ìƒˆë¡œìš´ ë²„íŠ¼ì„ ì¶”ê°€
    let existingSaveBtn = document.getElementById('saveBtn');
    if (existingSaveBtn) {
      existingSaveBtn.remove();
    }
    
    titleInput.parentNode.appendChild(saveBtn);
    saveBtn.id = 'saveBtn';
  }

  // ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ ì„œë²„ë¡œ ë³€ê²½ ì‚¬í•­ ì „ì†¡
  function saveTitle() {
    let newTitle = document.getElementById('diaryTitleInput').value;
    let currentTitle = "{{ mdiary.mtitle }}"; // í…œí”Œë¦¿ì—ì„œ í˜„ì¬ ì œëª© ê°’ ê°€ì ¸ì˜¤ê¸°

    if (newTitle !== currentTitle) {
      // ìˆ˜ì •ëœ ì œëª©ì´ ê¸°ì¡´ ì œëª©ê³¼ ë‹¤ë¥´ë©´ ì„œë²„ë¡œ ì „ì†¡
      fetch('/diary/update-title/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'  // CSRF í† í° ì¶”ê°€
        },
        body: JSON.stringify({ title: newTitle })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('ë‹¤ì´ì–´ë¦¬ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
          document.getElementById('diaryTitleInput').disabled = true;  // ì…ë ¥ì°½ ë¹„í™œì„±í™”
        } else {
          alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
    }
  }

  // ì·¨ì†Œ ì‹œ confirm ì°½ í‘œì‹œ í›„ ìˆ˜ì • ì·¨ì†Œ
  function cancelEdit() {
    if (confirm('ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      document.getElementById('diaryTitleInput').value = "{{mdiary.mtitle}}";  // ì›ë˜ ì œëª©ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
      document.getElementById('diaryTitleInput').disabled = true;  // ì…ë ¥ì°½ ë¹„í™œì„±í™”
    }
  }


  $(function() {
    // GNB í´ë¦­
    $('#menu ul li').on('click', function() {
      $('#menu ul li').removeClass('active');
      $(this).addClass('active');
    });
  });
</script>
</head>
<body>
<!-- ìµœìƒë‹¨ ë©”ë‰´ -->
<div id="top_nav">
  <h1><a href="#"></a></h1>
  <ul class="top_menu">
    <li><a href="#"><img src="/static/images/home/search_icon.png" alt=""></a></li>
    <li><a href="#"><img src="/static/images/home/bell_off_icon.png" alt=""></a></li>
    <li><a href="#">ë§ˆì´í˜ì´ì§€</a></li>
  </ul>

</div>

<!-- ì¢Œì¸¡ gnb -->
<div id="gnb">

  <!-- í”„ë¡œí•„ -->
  <div id="user_profile">
    <div id="pimg">
      <img src="/static/images/home/default_profile.png" alt="">
    </div>
    <p id="uName">ê¹€ìš©ì¤€</p>
    <p id="uEmail">kyjoon0105@gmail.com</p>
  </div>

  <!-- Nav -->
  <nav id="menu">
    <ul>
      <a href="/main/index/"><li class="menu_item">ìš°ë¦¬ ê°€ì¡± ì´ì•¼ê¸°</li></a>
      <a href="/diary/diaryHome/"><li class="menu_item active">ë‹¤ì´ì–´ë¦¬</li></a>
      <a href="#"><li class="menu_item">ê°ì • ëŒì•„ë³´ê¸°</li></a>
      <a href="#"><li class="menu_item">ìš°ë¦¬ê°€ì¡±</li></a>
      <a href="#"><li class="menu_item">ìº˜ë¦°ë”</li></a>
      <a href="#"><li class="menu_item">ì•Œë ¤ë“œë ¤ìš”</li></a>
    </ul>
  </nav>

  <!-- logout -->
  <div id="logout">
    <a href="#"><span>ë¡œê·¸ì•„ì›ƒ</span></a>
  </div>
  
</div>
<!-- ê³µí†µ ìƒë‹¨ì¢Œì¸¡ë©”ë‰´ -->


<!-- ë‹¤ì´ì–´ë¦¬ ë¦¬ìŠ¤íŠ¸ -->
<div id="main_area">

  <div id="title_area">
    <p id="infoTit">
      {% if mdiary %}
        {% comment %} {{mdiary.mtitle}} {% endcomment %}
        <input type="text" id="diaryTitleInput" value="{{mdiary.mtitle}}" disabled>
      {% else %}
      <input type="text" id="diaryTitleInput" value="ë‚´ ë‹¤ì´ì–´ë¦¬ ì´ë¦„ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”." disabled>
      {% endif %}
      <span><div id="modify_del_slide_1">
        <button type="button" id="addBtn">
        <img src="/static/images/customer/addBtn.png" alt="" id="openModal_1" style="cursor: pointer;">
        </button></span>
      <span>
        <button type="button" class="wBtn"><a href="/diary/diaryWrite/"><img id="writeBtn" src="/static/images/diary/writeBtn.png" alt=""></a></button>
        <div class="sub_menu_modal" id="sub_menu_modal_1">
          <div id="sub_menu_content">
            <button id="diaryEditBtn" onclick="enableEdit()">ë‹¤ì´ì–´ë¦¬ ìˆ˜ì •</button>
            {% comment %} <button id="diaryDeleteBtn">ë‹¤ì´ì–´ë¦¬ ì‚­ì œ</button> {% endcomment %}
          </div>
        </div>
      </div></span>
  </p>
    
    <p id="dateTit">{{mdiary.mdate|date:"Yë…„ mì›” dë¶€í„° ì”€"}}</p>
  </div>
  
  <div id="list_area">
    {% if content %}
    {% for c in content %}
    <div class="list_group">
      <a href="/diary/diaryView/">
        <div class="wrap_cont">
          <span class="tit_post"><span class="num_txt">{{forloop.revcounter}}</span>{{c.ctitle}}<span class="img"><img src="/static/images/diary/lock.png" alt=""></span></span>
          <p class="desc_cont">
            <span class="diaryTit">{{mdiary.mtitle}}</span><span class="space"> | </span>
            <span class="list_txt">{{c.ccontent}}
            </span>
          </p>
        </div>
        <dl class="list_post_info">
          <dd class="txt_g">
            <span>{{ c.cdate|date:"Y.m.d" }}</span><span class="space"> | </span>
            <span>ëŒ“ê¸€</span><span>01</span><span class="space"> | </span>
            <span>ì¢‹ì•„ìš”</span><span>02</span>
          </dd>
        </dl>
      </a>
    </div>
    {% endfor %}
    {% else %}
    ì¼ê¸°ë¥¼ ì‘ì„±í•´ë´…ì‹œë‹¤!ğŸ™Œ
    {% endif %}
    </div>

  </div>

  <ul class="page_num">
    <!-- ì´ì „í˜ì´ì§€ í™•ì¸ -->
    {% if MdiaryList.has_previous %}
      <a href="?npage=1"><li class="first"><img src="/static/images/diary/left_double.png" alt=""></li></a>
      <a href="?npage={{MdiaryList.previous_page_number}}"><li class="prev"><img src="/static/images/diary/left.png" alt=""></li></a>
    {% else %}
      <li class="first"></li>
      <li class="prev"></li>
    {% endif %}

    <!-- ìˆœì°¨ì  í˜ì´ì§€ ë„˜ë²„ë§ -->
    {% for page in MdiaryList.paginator.page_range %}
      {% if page == MdiaryList.number %}
        <a href="#"><li class="nowNum"><strong>{{page}}</strong></li></a>
      {% else %}
        <a href="?npage={{page}}"><li class="num"><div>{{page}}</div></li></a>
    {% comment %} <li class="nowNum"><a href="#">1</a></li> {% endcomment %}
      {% endif %}
    {% endfor %}

    <!-- ì´í›„í˜ì´ì§€ í™•ì¸ -->
    {% if MdiaryList.has_next %}
      <a href="?npage={{diary.next_page_number}}"><li class="next"><img src="/static/images/diary/right.png" alt=""></li></a>
      <a href="?npage={{diary.paginator.num_pages}}"><li class="last"><img src="/static/images/diary/right_double.png" alt=""></li></a>
    {% else %}
      <li class="next"></li>
      <li class="last"></li>
    {% endif %}

  </ul>
</div>

<script>
  // ì²« ë²ˆì§¸ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  document.getElementById('openModal_1').addEventListener('click', function() {
    var modal = document.getElementById('sub_menu_modal_1');
    console.log('ì²« ë²ˆì§¸ ëª¨ë‹¬ í´ë¦­ë¨');
    modal.classList.toggle('open'); // open í´ë˜ìŠ¤ê°€ ìˆìœ¼ë©´ ì œê±°, ì—†ìœ¼ë©´ ì¶”ê°€
  });

  
  document.getElementById('back_click').addEventListener('click', function() {
    console.log('ëª©ë¡ í´ë¦­ë¨');
    location.href='/customer/noticelist/'
  });
</script>

</body>
</html>